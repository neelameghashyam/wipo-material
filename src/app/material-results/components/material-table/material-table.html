<div class="table-container">
  <div class="table-controls">
    <button mat-raised-button [matMenuTriggerFor]="columnMenu">
      <mat-icon>view_column</mat-icon>
      Column Visibility
    </button>
    <mat-menu #columnMenu="matMenu">
      @for (column of columns; track column.key) {
        <button mat-menu-item (click)="$event.stopPropagation()">
          <mat-checkbox
            [checked]="column.visible"
            (change)="toggleColumn(column)"
            (click)="$event.stopPropagation()">
            {{column.label}}
          </mat-checkbox>
        </button>
      }
    </mat-menu>
  </div>
  <div class="table-wrapper"
       cdkDropList
       [cdkDropListOrientation]="'horizontal'"
       (cdkDropListDropped)="dropColumn($event)">
    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z2">
      <!-- Draggable Headers -->
      <ng-container [matColumnDef]="column.key" *ngFor="let column of columns">
        @if (column.visible) {
          <th mat-header-cell *matHeaderCellDef
              mat-sort-header
              cdkDrag>
            {{column.label}}
          </th>
          <td mat-cell *matCellDef="let element">
            {{element[column.key]}}
          </td>
        }
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>
  <mat-paginator
    [pageSizeOptions]="[5, 10, 20]"
    [pageSize]="10"
    showFirstLastButtons>
  </mat-paginator>
</div>