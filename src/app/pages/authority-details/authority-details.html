<app-header></app-header>

<!-- Loading styles will be in SCSS -->

<div class="main">
  <div class="container">
    
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading authority details...</p>
    </div>

    <!-- Content (only show when not loading) -->
    <ng-container *ngIf="!isLoading">
      
      <!-- HEADER -->
      <div class="base1">
        <div class="base">
          <div class="mat" (click)="navigateBack()" style="cursor: pointer;">
            <div class="arrow-icon-container">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18L9 12L15 6" stroke="#1f4e45" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div style="color: #1f4e45;">{{country.backText}}</div>
          </div>

          <div class="fla">
            <div class="flag">
              <div>
                <img 
                  *ngIf="country.flag" 
                  [src]="country.flag" 
                  [alt]="country.name"
                  (error)="country.flag = ''"
                >
                <div 
                  *ngIf="!country.flag" 
                  style="width: 38px; height: 38px; border-radius: 50%; background: #e0e0e0; border: 2px solid #DDE7E3;"
                ></div>
              </div>
              <div>
                <h2 style="color: #1f4e45;">
                  {{country.name}} <span style="font-weight: 400; font-size: 16px;">({{country.iso}})</span>
                </h2>
              </div>
            </div>
          </div>
        </div>

        <div class="btn1">
          <button style="color: aliceblue;">{{country.buttonText}}</button>
        </div>
      </div>

      <!-- TABS -->
      <div class="tabs-container">
        <div class="tab" [class.active]="activeTab === 'protection'" (click)="setTab('protection')">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L3 6V12C3 17.5 7.5 22 12 22C16.5 22 21 17.5 21 12V6L12 2Z" stroke="#1f4e45" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M8 12.5L11 15.5L16 9.5" stroke="#1f4e45" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </svg> 
          Protection 
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 48 48" fill="#1f4e45">
            <path d="M24 4q8.25 0 14.125 5.875Q44 15.75 44 24q0 8.25-5.875 14.125Q32.25 44 24 44q-8.25 0-14.125-5.875Q4 32.25 4 24q0-8.25 5.875-14.125Q15.75 4 24 4Zm0 36q6.6 0 11.3-4.7Q40 30.6 40 24q0-6.6-4.7-11.3Q30.6 8 24 8q-6.6 0-11.3 4.7Q8 18.4 8 24q0 6.6 4.7 11.3Q18.4 40 24 40Zm-2-6h4V22h-4v12Zm2-16q.85 0 1.425-.575Q26 16.85 26 16q0-.85-.575-1.425Q24.85 14 24 14q-.85 0-1.425.575Q22 15.15 22 16q0 .85.575 1.425Q23.15 18 24 18Z" />
          </svg>
        </div>
        <div class="tab" [class.active]="activeTab === 'dus'" (click)="setTab('dus')">
          <mat-icon>menu_book</mat-icon>
          DUS Guidance and Cooperation
        </div>
      </div>

      <hr class="divider">

      <!-- CONTENT -->
      <div class="content">
        
        <!-- PROTECTION TAB -->
        <div class="content1" *ngIf="activeTab === 'protection'">
          <div class="left-text">
            This member of the Union <strong>protects the whole or essentially <br>the whole plant kingdom.</strong>
          </div>

          <div class="contact-card1">
            <h3>{{contact.title}}</h3>
            <p><strong>{{contact.registrar}}</strong><br>{{contact.department}}</p>

            <div class="contact-item">
              <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A32 32 0 0 1 8 14.58a32 32 0 0 1-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0 1 10 0c0 .862-.305 1.867-.834 2.94M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10"/>
                  <path d="M8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4m0 1a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>
                </svg>
              </span>
              <span>
                {{contact.department}}<br>
                {{country.name}}
              </span>
            </div>

            <div class="contact-item">
              <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M11 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM5 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                  <path d="M8 14a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
                </svg>
              </span>
              <span>{{contact.phone}}</span>
            </div>

            <div class="contact-item">
              <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1zm13 2.383-4.708 2.825L15 11.105zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741M1 11.105l4.708-2.897L1 5.383z"/>
                </svg>
              </span>
              <span class="contact-link">{{contact.email}}</span>
            </div>

            <div class="contact-item">
              <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m7.5-6.923c-.67.204-1.335.82-1.887 1.855A8 8 0 0 0 5.145 4H7.5zM4.09 4a9.3 9.3 0 0 1 .64-1.539 7 7 0 0 1 .597-.933A7.03 7.03 0 0 0 2.255 4zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a7 7 0 0 0-.656 2.5zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5zM8.5 5v2.5h2.99a12.5 12.5 0 0 0-.337-2.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5zM5.145 12q.208.58.468 1.068c.552 1.035 1.218 1.65 1.887 1.855V12zm.182 2.472a7 7 0 0 1-.597-.933A9.3 9.3 0 0 1 4.09 12H2.255a7 7 0 0 0 3.072 2.472M3.82 11a13.7 13.7 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5zm6.853 3.472A7 7 0 0 0 13.745 12H11.91a9.3 9.3 0 0 1-.64 1.539 7 7 0 0 1-.597.933M8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855q.26-.487.468-1.068zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.7 13.7 0 0 1-.312 2.5m2.802-3.5a7 7 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7 7 0 0 0-3.072-2.472c.218.284.418.598.597.933M10.855 4a8 8 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4z"/>
                </svg>
              </span>
              <span class="contact-link">{{contact.website}}</span>
            </div>
          </div>
        </div>

        <!-- DUS TAB -->
        <div *ngIf="activeTab === 'dus'">
          <div class="dus-header">
            <h2 class="main-title">Taxa for which the authority has practical DUS experience <span class="count">({{displayProducts.length}})</span></h2>
            <label class="label">Select the specie</label>
          </div>

          <div class="dropdown-container">
            <div class="auto-search">
              <mat-icon class="search-icon">search</mat-icon>

              <input
                type="text"
                [formControl]="searchCtrl"
                placeholder="Search by UPOV code, botanical name, common name…"
              />

              <button
                *ngIf="searchCtrl.value"
                class="clear-btn"
                (click)="clearSearch()"
                type="button"
              >
                <mat-icon>close</mat-icon>
              </button>
            </div>
          </div>

          <div class="content1">
            <div style="flex: 1;">
              <div class="species-grid">
                <div 
                  class="species-card" 
                  *ngFor="let product of getPaginatedProducts()"
                  (click)="navigateToSpecies(product.genieId)"
                  style="cursor: pointer;"
                >
                  <div class="species-content">
                    <div class="species-code-row">
                      <mat-icon class="species-icon">spa</mat-icon>
                      <span class="species-code">{{ product.upovCode }}</span>
                    </div>

                    <h3 class="species-name">{{ product.botanicalName }}</h3>

                    <p class="species-common" *ngIf="product.commonName">
                      {{ product.commonName }}
                    </p>

                    <p class="species-family" *ngIf="product.family">
                      {{ product.family }}
                    </p>

                    <p class="species-crop-type" *ngIf="product.fullDetails?.cropType">
                      {{ product.fullDetails.cropType }}
                    </p>
                  </div>

                  <div class="species-image-wrapper">
                    <img
                      *ngIf="product.imageUrl"
                      [src]="product.imageUrl"
                      [alt]="product.botanicalName"
                      class="species-image"
                    />

                    <div *ngIf="!product.imageUrl" class="species-placeholder-image">
                      <span class="no-image-text">No image<br />available</span>
                    </div>

                    <span class="updated-badge" *ngIf="product.updated">
                      Updated
                    </span>
                  </div>
                </div>
              </div>

              <!-- PAGINATION -->
              <div class="pagination" *ngIf="shouldShowPagination()">
                <div class="pagination-inner">
                  
                  <button class="page-btn nav-btn" [disabled]="currentPage === 1" (click)="changePage(1)">
                    <mat-icon class="chevron double">keyboard_double_arrow_left</mat-icon>
                  </button>

                  <button class="page-btn nav-btn" [disabled]="currentPage === 1" (click)="changePage(currentPage - 1)">
                    <mat-icon class="chevron">chevron_left</mat-icon>
                  </button>

                  <ng-container *ngFor="let page of getPageNumbers()">
                    <button *ngIf="page !== '...'" class="page-btn page-number" [class.active]="page === currentPage" (click)="changePage(page)">
                      {{ page }}
                    </button>
                    <span *ngIf="page === '...'" class="page-dots">…</span>
                  </ng-container>

                  <div class="page-info-wrapper">
                    <button class="page-btn page-info-btn" type="button" (click)="togglePageDropdown()">
                      <span class="page-info-text">{{ currentPage }} of {{ getTotalPages() }}</span>
                      <mat-icon class="page-info-icon">expand_more</mat-icon>
                    </button>

                    <div class="page-dropdown" *ngIf="showPageDropdown">
                      <button class="page-dropdown-item" *ngFor="let page of getAllPages()" [class.active]="page === currentPage" (click)="goToPageFromDropdown(page)">
                        {{ page }}
                      </button>
                    </div>
                  </div>

                  <button class="page-btn nav-btn" [disabled]="currentPage === getTotalPages()" (click)="changePage(currentPage + 1)">
                    <mat-icon class="chevron">chevron_right</mat-icon>
                  </button>

                  <button class="page-btn nav-btn" [disabled]="currentPage === getTotalPages()" (click)="changePage(getTotalPages())">
                    <mat-icon class="chevron double">keyboard_double_arrow_right</mat-icon>
                  </button>

                </div>
              </div>
            </div>

            <div class="contact-card1">
              <h3>{{contact.title}}</h3>
              <p><strong>{{contact.registrar}}</strong></p>
              <p>{{contact.department}}</p>
        
              <div class="contact-item">
                <span class="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A32 32 0 0 1 8 14.58a32 32 0 0 1-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0 1 10 0c0 .862-.305 1.867-.834 2.94M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10"/>
                    <path d="M8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4m0 1a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>
                  </svg>
                </span>
                <span>
                  {{contact.department}}<br>
                  {{country.name}}
                </span>
              </div>

              <div class="contact-item">
                <span class="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M11 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM5 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                    <path d="M8 14a1 1 0 1 0 0-2 1 1 0 0 0 0 2"/>
                  </svg>
                </span>
                <span>{{contact.phone}}</span>
              </div>

              <div class="contact-item">
                <span class="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1zm13 2.383-4.708 2.825L15 11.105zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741M1 11.105l4.708-2.897L1 5.383z"/>
                </svg>
              </span>
              <span class="contact-link">{{contact.email}}</span>
            </div>

            <div class="contact-item">
              <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m7.5-6.923c-.67.204-1.335.82-1.887 1.855A8 8 0 0 0 5.145 4H7.5zM4.09 4a9.3 9.3 0 0 1 .64-1.539 7 7 0 0 1 .597-.933A7.03 7.03 0 0 0 2.255 4zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a7 7 0 0 0-.656 2.5zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5zM8.5 5v2.5h2.99a12.5 12.5 0 0 0-.337-2.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5zM5.145 12q.208.58.468 1.068c.552 1.035 1.218 1.65 1.887 1.855V12zm.182 2.472a7 7 0 0 1-.597-.933A9.3 9.3 0 0 1 4.09 12H2.255a7 7 0 0 0 3.072 2.472M3.82 11a13.7 13.7 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5zm6.853 3.472A7 7 0 0 0 13.745 12H11.91a9.3 9.3 0 0 1-.64 1.539 7 7 0 0 1-.597.933M8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855q.26-.487.468-1.068zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.7 13.7 0 0 1-.312 2.5m2.802-3.5a7 7 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7 7 0 0 0-3.072-2.472c.218.284.418.598.597.933M10.855 4a8 8 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4z"/>
                </svg>
              </span>
              <span class="contact-link">{{contact.website}}</span>
            </div>
          </div>
          </div>
        </div>
      </div>
    
    </ng-container>
  </div>
</div>

<app-footer></app-footer>